## TODO: OK, R seems to install by moving the package to a new location
## so make SEQLIB_ROOT a system variable
## TODO: figure out proper Makevars / configure way to do this

SEQLIB_ROOT=./SeqLib/
PKG_CPPFLAGS = -I$(SEQLIB_ROOT)/ -I$(SEQLIB_ROOT)/htslib/
PKG_LIBS = $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) $(SEQLIB_ROOT)/bwa/libbwa.a $(SEQLIB_ROOT)/src/libseqlib.a $(SEQLIB_ROOT)/fermi-lite/libfml.a $(SEQLIB_ROOT)/htslib/libhts.a -fPIC

.PHONY: SeqLib all

all : $(SHLIB)

$(SHLIB) : SeqLib

SeqLib:
	(cd SeqLib && \
	./configure CPPFLAGS="-fPIC" LDFLAGS="-fPIC" CFLAGS="-fPIC" CXXFLAGS="-fPIC" && \
	cd src && make CXX="`R CMD config CXX`" && cd ../ \
	cd htslib && make CPPFLAGS="-fPIC " && cd ../ \
	$(MAKE) all && cd ..)

##&& \
##	sed '/^CPPFLAGS/s/CPPFLAGS =/c\CPPFLAGS = -fPIC/' htslib/Makefile > htslib/Makefile.temp && \
##	mv htslib/Makefile.temp htslib/Makefile && \
##	$(MAKE) all && cd ..)
